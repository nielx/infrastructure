user nginx;
worker_processes auto;

error_log /var/log/nginx/error.log warn;
pid /var/run/nginx.pid;

events {
	worker_connections 2048;
	use epoll;
	multi_accept on;
}

http {
	proxy_cache_path /tmp/nginx levels=1:2 keys_zone=cache:10m inactive=60m max_size=8g;
	proxy_cache cache;
	proxy_cache_revalidate on;
	proxy_cache_use_stale error timeout updating;

	add_header X-Proxy-Cache $upstream_cache_status;

	ssl_session_cache shared:SSL:10m;
	ssl_session_timeout 30m;

	access_log off;

	server {
		listen 80;
		listen [::]:80;

		return 301 https://$host$request_uri;
	}

### auto-generated by ./generate_conf.sh
	server {
		listen 443 ssl http2;
		listen [::]:443 ssl http2;
		server_name haiku-os.org;
		ssl_certificate /letsencrypt/live/haiku-os.org/fullchain.pem;
		ssl_certificate_key /letsencrypt/live/haiku-os.org/privkey.pem;

		location / {
			proxy_pass http://78.46.189.196:8081;
			proxy_set_header Host $host;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		}

		location /.well-known/acme-challenge/ {
			alias /letsencrypt/acme/;
		}
	}
	server {
		listen 443 ssl http2;
		listen [::]:443 ssl http2;
		server_name api.haiku-os.org;
		ssl_certificate /letsencrypt/live/api.haiku-os.org/fullchain.pem;
		ssl_certificate_key /letsencrypt/live/api.haiku-os.org/privkey.pem;

		location / {
			proxy_pass http://78.46.189.196:8081;
			proxy_set_header Host $host;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		}

		location /.well-known/acme-challenge/ {
			alias /letsencrypt/acme/;
		}
	}
	server {
		listen 443 ssl http2;
		listen [::]:443 ssl http2;
		server_name buildbot.haiku-os.org;
		ssl_certificate /letsencrypt/live/buildbot.haiku-os.org/fullchain.pem;
		ssl_certificate_key /letsencrypt/live/buildbot.haiku-os.org/privkey.pem;

		location / {
			proxy_pass http://78.46.189.196:8081;
			proxy_set_header Host $host;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		}

		location /.well-known/acme-challenge/ {
			alias /letsencrypt/acme/;
		}
	}
	server {
		listen 443 ssl http2;
		listen [::]:443 ssl http2;
		server_name buildbot-test.haiku-os.org;
		ssl_certificate /letsencrypt/live/buildbot-test.haiku-os.org/fullchain.pem;
		ssl_certificate_key /letsencrypt/live/buildbot-test.haiku-os.org/privkey.pem;

		location / {
			proxy_pass http://78.46.189.196:8081;
			proxy_set_header Host $host;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		}

		location /.well-known/acme-challenge/ {
			alias /letsencrypt/acme/;
		}
	}
	server {
		listen 443 ssl http2;
		listen [::]:443 ssl http2;
		server_name download.haiku-os.org;
		ssl_certificate /letsencrypt/live/download.haiku-os.org/fullchain.pem;
		ssl_certificate_key /letsencrypt/live/download.haiku-os.org/privkey.pem;

		location / {
			proxy_pass http://78.46.189.196:8081;
			proxy_set_header Host $host;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		}

		location /.well-known/acme-challenge/ {
			alias /letsencrypt/acme/;
		}
	}
	server {
		listen 443 ssl http2;
		listen [::]:443 ssl http2;
		server_name ports-mirror.haiku-os.org;
		ssl_certificate /letsencrypt/live/ports-mirror.haiku-os.org/fullchain.pem;
		ssl_certificate_key /letsencrypt/live/ports-mirror.haiku-os.org/privkey.pem;

		location / {
			proxy_pass http://78.46.189.196:8081;
			proxy_set_header Host $host;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		}

		location /.well-known/acme-challenge/ {
			alias /letsencrypt/acme/;
		}
	}
	server {
		listen 443 ssl http2;
		listen [::]:443 ssl http2;
		server_name userguide.haiku-os.org;
		ssl_certificate /letsencrypt/live/userguide.haiku-os.org/fullchain.pem;
		ssl_certificate_key /letsencrypt/live/userguide.haiku-os.org/privkey.pem;

		location / {
			proxy_pass http://78.46.189.196:8081;
			proxy_set_header Host $host;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		}

		location /.well-known/acme-challenge/ {
			alias /letsencrypt/acme/;
		}
	}
}

